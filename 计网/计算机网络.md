# 计算机网络

网络：是能够将主机连接起来，就构成了一个网络

互联网：将不同的网络连接起来，所以**互联网是网络的网络**——internet

Internet：是全球范围内的internet，专有名词。

# 0. 概述

主要是介绍概念：

## ISP：互联网服务提供商

提供商可以从**互联网管理机构**获得许多 IP 地址，同时拥有通信线路以及路由器等联网设备，个人或机构向 ISP 缴纳一定的费用就可以接入互联网。

<img src="pic/isp.png" style="zoom:50%;" >

目前的互联网是一种**多层次 ISP 结构**，ISP 根据覆盖面积的大小分为**第一层 ISP、区域 ISP 和接入 ISP**。

**互联网交换点 IXP 允许两个 ISP 直接相连而不用经过第三个 ISP。**

<img src="pic/multi-isp.png" style="zoom:50%;" >

## 主机之间的通信方式

- CS（客户/服务器）：请求方是客户端，响应方是服务器，提供请求的服务
- P2P：之间对等，不区分

## 电路交换和分组交换

- 电路交换：**电话通信系统**，两个用户要通信之前需要建立一条**专用的物理链路**，在整个通信过程中始终占用该链路。由于通信的过程中不可能一直在使用传输线路，因此电路交换对线路的利用率很低，往往不到 10%。——专用的线路
- 分组交换：每个分组都有首部和尾部，包含了源地址和目的地址等控制信息，在同一个传输线路上同时传输多个分组互相不会影响，因此在同一条传输线路上允许同时传输多个分组，也就是说分组交换不需要占用传输线路。——公用的线路

**存储转发**：分组交换中用到，即某个节点收到信息后，先存储下来，然后之后将相同目的地的信息转发出去，用在邮局通信系统（现在的物流也是这样）

## 时延

总时延 = 排队时延 + 处理时延 + 传输时延 + 传播时延

1. 排队时延：在**路由器**的输入队列和输出队列中排队等待的时间，取决于**网络当前的通信量**

2. 处理时延：收到分组时进行**处理**所需要的时间，例如分析首部、从分组中提取数据、进行差错检验或查找适当的路由等

3. 传输时延：**主机或路由器**传输数据帧所需要的时间

   也就是从发送数据帧的第一个比特算起，到该帧的最后一个比特发送完毕所需的时间

   传输时延又称发送时延，即**主机or路由器将数据帧发送出去所需要的全部时间**，时延发生在机器的内部的发送器。

   注意和传播时延做区分

   $delay = \frac{l(bit)}{v(bit/s)}$

   l是帧的长度，v传输速率

4. 传播时延：电磁波在**信道**中传播所需要花费的时间，电磁波的传播速度接近光速

   $delay=\frac{l(m)}{v(m/s)}$

   l是信道长度，v是电磁波在信道上的传播速度

   时延发生在机器外部的传输信道媒体。

   电磁波在自由空间的传播速率是光速，即3.0×105km/s。电磁波在网络传输媒体中的传播速率比在自由空间要略低一些：在铜线电缆中的传播速率约为2.3×105km/s，在光纤中的传播速率约为2.0×105km/s。例如，1000km长的光纤线路产生的传播时延大约为5ms。【摘自计算机网络1.6.1】

## 网络体系结构

<img src="pic/osi.jpg" style="zoom: 80%;" >

### 5层模型（最常见）

从上到下：

1. 应用层

   为**特定应用程序**提供数据传输服务，例如 HTTP、DNS 等协议。数据单位为**报文**。

2. 传输层

   为**进程**提供通用数据传输服务

   由于应用层协议很多，定义通用的传输层协议就可以支持不断增多的应用层协议。

   主要有以下的两种协议：

   - **传输控制协议 TCP**，提供面向连接、可靠的数据传输服务，数据单位为**报文段**；
   - **用户数据报协议 UDP**，提供无连接、尽最大努力的数据传输服务，数据单位为**用户数据报**

   **TCP 主要提供完整性服务，UDP 主要提供及时性服务。**

3. 网络层

   为**主机**提供数据传输服务。

   网络层把传输层传递下来的报文段或者用户数据报封装成**分组**。

4. 数据链路层

   主机之间的数据传输，需要在一段段链路上传送，链路层协议就是为**同一链路的主机提供数据传输服务**，即在同一个链路两端的结点之间进行传输

   数据链路层把网络层传下来的分组封装成**帧**。

5. 物理层

   考虑的是怎样在**传输媒体**上传输数据比特流，而不是指具体的传输媒体。物理层的作用是**尽可能屏蔽传输媒体和通信手段的差异，使数据链路层感觉不到这些差异。**

   即对上（数据链路层）提供统一的传输数据接口，虽然物理层会采用不同的传输媒体和通信手段

   请注意，传递信息所利用的一些**物理媒体并不在物理层协议之内而是在物理层协议的下面**，如双绞线、同轴电缆、光缆、无线信道等——也有人把物理媒体当作第0层。

   类似于：驱动和物理设备的关系

| 层名       | 服务对象           | 数据单位 |
| ---------- | ------------------ | -------- |
| 应用层     | 特定的应用程序     | 报文     |
| 传输层     | 进程（通用服务）   | 数据报   |
| 网络层     | 主机               | 分组     |
| 数据链路层 | 同一链路的两个节点 | 帧       |
| 物理层     | 传输媒体驱动       | 数据流   |

### 7层OSI模型

增加了两层：

- 表示层：数据压缩、加密以及数据描述。应用程序不必关心在各台主机中数据内部格式不同的问题。
- 会话层：建立及管理会话

五层协议没有表示层和会话层，而是将这些功能留给应用程序开发者处理。

### TCP/IP模型

是4层模型，将最下面的数据链路层和物理层合并为网络接口层

TCP/IP 体系结构不严格遵循 OSI 分层概念，应用层可能会直接使用 IP 层或者网络接口层。

### 数据在各层之间的传递

在向下的过程中，需要添加下层协议所需要的首部或者尾部，而在向上的过程中不断拆开首部和尾部。

**路由器只有下面三层协议**，因为路由器位于网络核心中，不需要为进程或者应用程序提供服务，因此也就不需要传输层和应用层。

# 1. 物理层

## 通信方式

根据信息在传输线上的传送方向，分为以下三种通信方式：

- 单工通信：单向传输

  eg：广播、电视

- 半双工通信：双向交替传输

  即通信的双方都可以发送信息和接收，但不能双方同时发送/接收。这种通信方式是一方发送另一方接收，过一段时间后再反过来。

- 全双工通信：双向同时传输

## 带通调制

模拟信号是连续的信号，数字信号是离散的信号。带通调制把数字信号转换为模拟信号。

# 2. 链路层

链路层的最重要的内容

- 数据链路层的点对点信道和广播信道的特点，以及这两种信道所使用的协议（PPP协议以及CSMA/CD协议）的特点
- 数据链路层的三个基本技术：封装成帧、透明传输和差错检测
-  以太网MAC层的硬件地址
- 适配器、转发器、集线器、网桥、以太网交换机的作用以及使用场合。

## 2.1 基本技术

基本技术包括：封装成帧、透明传输、差错检测

### 封装成帧

**将网络层传下来的分组添加首部和尾部，用于标记帧的开始和结束**，即在分组外面再套一层，主要用来分界

<img src="pic/frame.png" style="zoom: 80%;" >



### 透明传输

主要是分界需要用到一些字符，而该字符如果在数据部分出现，那么会引起歧义（例如提前断帧），所以需要将这些字符进行处理，从而将整个数据部分当作透明的存在

（有点像玻璃窗，窗边的黑框表示分界，而中间的数据部分就是透明的玻璃，如果数据部分存在和分界一样的内容，需要处理，从而将这些歧义的部分也当作透明）

官方的定义：帧使用首部和尾部进行定界，如果帧的数据部分含有和首部尾部相同的内容，那么帧的开始和结束位置就会被错误的判定。需要在**数据部分出现首部尾部相同的内容前面插入转义字符**。如果数据部分出现转义字符，那么就在**转义字符前面再加个转义字符**。在接收端进行处理之后可以还原出原始数据。这个过程透明传输的内容是转义字符，用户察觉不到转义字符的存在。

——该方法被称为**字节填充**

<img src="pic/stuffing.png" style="zoom: 67%;" >

（why在转义字符之前再加一个转义字符，

​    $\because$ 接收端的数据链路层会把数据送往网络层之前删除这个插入的转义字符，那么本来就是该内容的被删除了，而增加了一个转义字符，那么只删除前面一个，还能还原原样）

### 差错检测

目前数据链路层广泛使用了循环冗余检验（CRC）来检查比特差错。

## 2.2 信道

### 信道分类

- 广播信道：一对多通信，一个节点发送的数据能够被广播信道上所有的节点接收到。

  所有的节点都在同一个广播信道上发送数据，因此需要有专门的控制方法进行协调，避免发生冲突（冲突也叫碰撞）。

  控制的方法有两种：信道复用技术，CSMA/CD 协议

- 点对点信道：一对一通信

  不会发生碰撞，比较简单，用PPP协议进行控制

### 信道复用

背景：同一个信道，可能有很多设备都需要使用

- 频分复用：所有主机在相同时间**占用不同的频率**带宽资源——同一时刻有多个信息在传输
- 时分复用：所有主机在**不同时间占用**相同的频率带宽资源——同一时刻只有一个信息在传输

——这两种通信方式，**在通信的过程中主机会一直占用一部分信道资源**。但是由于计算机数据的突发性质，通信过程没必要一直占用信道资源而不让出给其它用户使用，因此这两种方式对信道的利用率都不高。

- 统计时分复用：不固定每个用户在时分复用帧中的位置，只要有数据就集中起来组成统计时分复用帧然后发送。
- 波分复用：采用不同的波长来光来传递不同的信息
- 码分复用

### CSMA/CD协议

载波监听多点接入 / 碰撞检测。



### PPP协议

## 2.3 MAC地址

## 2.4 链路层设备

# 3. 网络层

# 4. 传输层

# 5. 应用层